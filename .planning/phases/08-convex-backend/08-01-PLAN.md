---
phase: 08-convex-backend
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/frontend/package.json
  - packages/frontend/convex/schema.ts
  - packages/frontend/convex/_generated/
  - packages/frontend/src/app/layout.tsx
  - packages/frontend/src/components/providers/ConvexClientProvider.tsx
autonomous: true
user_setup:
  - service: convex
    why: 'Convex requires a free account for project deployment'
    env_vars:
      - name: NEXT_PUBLIC_CONVEX_URL
        source: 'Auto-generated by `npx convex dev` - saved to .env.local'
    account_setup:
      - url: 'https://dashboard.convex.dev/signup'
        skip_if: 'Already have Convex account - will prompt during npx convex dev'
    dashboard_config: []
    local_dev:
      - 'npx convex dev (runs Convex development server)'
---

<objective>
Initialize Convex in the frontend package with schema for fantasy football app.

Purpose: Establish Convex as the backend-as-a-service for app state, scoring configs, and cached predictions.
Output: Working Convex dev environment with schema and React provider.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 7 established the Python prediction API:

# - POST /predict/qb returns {passing_yards, passing_tds}

# - POST /predict/rb returns {rushing_yards, rushing_tds, carries, receiving_yards, receptions}

# - POST /predict/wr and /predict/te return {receiving_yards, receiving_tds, receptions}

@packages/frontend/package.json
@packages/frontend/src/app/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Convex and initialize project</name>
  <files>packages/frontend/package.json, packages/frontend/convex/, packages/frontend/.env.local</files>
  <action>
    1. cd packages/frontend
    2. Run `pnpm add convex` to install Convex React client
    3. Run `pnpm dlx convex dev` to initialize Convex project (will prompt for account login if needed)
    4. This creates convex/ directory with _generated/ folder and .env.local with NEXT_PUBLIC_CONVEX_URL

    Note: First run of `pnpm dlx convex dev` will open browser for authentication if not logged in. Keep the dev server running for schema deployment.

  </action>
  <verify>
    - convex/ directory exists with _generated/ folder
    - .env.local contains NEXT_PUBLIC_CONVEX_URL
    - `pnpm dlx convex dev` shows "Convex functions ready"
  </verify>
  <done>Convex initialized with dev server running</done>
</task>

<task type="auto">
  <name>Task 2: Create Convex schema with tables</name>
  <files>packages/frontend/convex/schema.ts</files>
  <action>
    Create convex/schema.ts defining three tables:

    1. **scoringConfigs** - User scoring configurations
       - name: v.string() - Config name (e.g., "Standard", "PPR", "Half-PPR")
       - isDefault: v.boolean() - Whether this is the active config
       - passing: v.object({
           yardsPerPoint: v.number(),  // e.g., 25 (1 pt per 25 yards)
           tdPoints: v.number(),       // e.g., 4
           intPoints: v.number(),      // e.g., -2
         })
       - rushing: v.object({
           yardsPerPoint: v.number(),  // e.g., 10
           tdPoints: v.number(),       // e.g., 6
         })
       - receiving: v.object({
           yardsPerPoint: v.number(),  // e.g., 10
           tdPoints: v.number(),       // e.g., 6
           receptionPoints: v.number(), // e.g., 0 (standard) or 1 (PPR)
         })
       - Index: by_default on isDefault for quick lookup

    2. **cachedPredictions** - Store predictions from Python API
       - playerId: v.string() - Player identifier
       - position: v.string() - "QB", "RB", "WR", "TE"
       - week: v.number() - NFL week number
       - season: v.number() - NFL season year
       - predictions: v.object({...}) - Position-specific predictions (flexible)
       - createdAt: v.number() - Timestamp for cache invalidation
       - Index: by_player on playerId
       - Index: by_player_week on [playerId, week, season]

    3. **players** - Player metadata for selection UI
       - playerId: v.string() - Unique player ID
       - name: v.string() - Display name
       - position: v.string() - "QB", "RB", "WR", "TE"
       - team: v.string() - Team abbreviation
       - Index: by_position on position
       - Index: by_team on team

    Use v.optional() where appropriate. Export default schema.

  </action>
  <verify>
    - `npx convex dev` outputs "Schema updated" or similar
    - No TypeScript errors in schema.ts
  </verify>
  <done>Schema deployed with all three tables and indexes</done>
</task>

<task type="auto">
  <name>Task 3: Create ConvexClientProvider and integrate into layout</name>
  <files>packages/frontend/src/components/providers/ConvexClientProvider.tsx, packages/frontend/src/app/layout.tsx</files>
  <action>
    1. Create src/components/providers/ConvexClientProvider.tsx as a client component:
       ```tsx
       "use client";
       import { ConvexProvider, ConvexReactClient } from "convex/react";
       import { ReactNode } from "react";

       const convex = new ConvexReactClient(process.env.NEXT_PUBLIC_CONVEX_URL!);

       export function ConvexClientProvider({ children }: { children: ReactNode }) {
         return <ConvexProvider client={convex}>{children}</ConvexProvider>;
       }
       ```

    2. Update src/app/layout.tsx to wrap children with ConvexClientProvider:
       - Import ConvexClientProvider
       - Wrap {children} with <ConvexClientProvider>

    Note: ConvexClientProvider must be a client component ("use client") because ConvexReactClient uses browser APIs.

  </action>
  <verify>
    - `pnpm build` completes without errors
    - `pnpm dev` starts and console shows Convex connection
  </verify>
  <done>ConvexClientProvider integrated into app layout</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx convex dev` running without errors
- [ ] Schema has scoringConfigs, cachedPredictions, players tables
- [ ] Each table has appropriate indexes defined
- [ ] `pnpm build` succeeds in packages/frontend
- [ ] `pnpm dev` starts and connects to Convex
</verification>

<success_criteria>

- Convex initialized in packages/frontend
- Schema defines 3 tables with proper types and indexes
- ConvexClientProvider wraps app for React hooks
- Development server connects successfully
  </success_criteria>

<output>
After completion, create `.planning/phases/08-convex-backend/08-01-SUMMARY.md`
</output>
