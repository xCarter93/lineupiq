---
phase: 08-convex-backend
plan: 02
type: execute
wave: 2
depends_on: ['08-01']
files_modified:
  - packages/frontend/convex/scoringConfigs.ts
  - packages/frontend/hooks/useScoringConfigs.ts
  - packages/frontend/app/providers/ConvexClientProvider.tsx
autonomous: true
---

<objective>
Implement CRUD operations for fantasy scoring configurations.

Purpose: Allow users to customize how fantasy points are calculated from predicted stats.
Output: Convex queries/mutations and React hooks for scoring config management.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-convex-backend/08-01-SUMMARY.md

# Standard scoring reference from PROJECT.md:

# - Passing: 1pt/25 yards, 4pt/TD, -2pt/INT

# - Rushing: 1pt/10 yards, 6pt/TD

# - Receiving: 1pt/10 yards, 6pt/TD, 0pt/reception (standard) or 1pt (PPR)

@packages/frontend/convex/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Convex functions for scoring configs</name>
  <files>packages/frontend/convex/scoringConfigs.ts</files>
  <action>
    Create convex/scoringConfigs.ts with:

    **Queries:**
    1. `list` - Return all scoring configs, ordered by name
    2. `getDefault` - Return the config where isDefault is true
    3. `getById` - Return single config by _id

    **Mutations:**
    1. `create` - Create new scoring config
       - Args: name, passing, rushing, receiving, isDefault (optional)
       - If isDefault true, set all other configs to isDefault: false first
       - Return new config _id

    2. `update` - Update existing config
       - Args: id, partial fields (name, passing, rushing, receiving, isDefault)
       - If setting isDefault to true, clear other defaults first
       - Return updated config _id

    3. `remove` - Delete config
       - Args: id
       - Prevent deleting the default config (throw error)

    4. `setDefault` - Set a config as default
       - Args: id
       - Clear all other isDefault flags, set this one true

    5. `seedDefaults` - Create standard scoring presets if none exist
       - Only runs if no configs exist
       - Creates: "Standard" (default), "PPR", "Half-PPR"

    Import from "./_generated/server" and use `v` from "convex/values" for arg validation.

  </action>
  <verify>
    - `pnpm dlx convex dev` shows functions deployed without errors
    - No TypeScript errors in scoringConfigs.ts
  </verify>
  <done>All scoring config Convex functions deployed</done>
</task>

<task type="auto">
  <name>Task 2: Create React hooks for scoring config operations</name>
  <files>packages/frontend/hooks/useScoringConfigs.ts</files>
  <action>
    Create hooks/useScoringConfigs.ts with custom hooks:

    1. `useScoringConfigs()` - Hook returning all scoring configs
       - Uses useQuery with api.scoringConfigs.list
       - Returns { configs, isLoading }

    2. `useDefaultScoringConfig()` - Hook returning the default config
       - Uses useQuery with api.scoringConfigs.getDefault
       - Returns { config, isLoading }

    3. `useScoringConfigMutations()` - Hook returning mutation functions
       - Uses useMutation for create, update, remove, setDefault, seedDefaults
       - Returns { create, update, remove, setDefault, seedDefaults }

    Import api from "@/convex/_generated/api" (using path alias).

    Example usage pattern:
    ```tsx
    const { configs, isLoading } = useScoringConfigs();
    const { create, setDefault } = useScoringConfigMutations();
    ```

  </action>
  <verify>
    - No TypeScript errors in useScoringConfigs.ts
    - Imports resolve correctly (api types generated)
  </verify>
  <done>React hooks ready for scoring config CRUD</done>
</task>

<task type="auto">
  <name>Task 3: Add seed defaults action to provider initialization</name>
  <files>packages/frontend/app/providers/ConvexClientProvider.tsx</files>
  <action>
    Update ConvexClientProvider to seed default configs on first load:

    1. Import useMutation and api
    2. Create a SeedDefaults component that:
       - Uses useMutation(api.scoringConfigs.seedDefaults)
       - Calls seedDefaults() once on mount using useEffect
       - Renders null (no UI)
    3. Include <SeedDefaults /> inside the ConvexProvider

    This ensures standard scoring presets exist when app first loads.

    Note: The seedDefaults mutation is idempotent - it only creates configs if none exist.

  </action>
  <verify>
    - `pnpm dev` starts without errors
    - Convex dashboard shows 3 scoringConfigs documents after first load
  </verify>
  <done>Default scoring configs seeded on app initialization</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm dlx convex dev` shows all functions deployed
- [ ] Convex dashboard shows scoringConfigs table with 3 presets after app load
- [ ] TypeScript compiles without errors
- [ ] React hooks properly typed with Convex generated types
</verification>

<success_criteria>

- 5 mutations + 3 queries for scoring configs
- React hooks abstract Convex API calls
- Default presets seeded on first app load
- CRUD operations work via Convex dashboard test
  </success_criteria>

<output>
After completion, create `.planning/phases/08-convex-backend/08-02-SUMMARY.md`
</output>
