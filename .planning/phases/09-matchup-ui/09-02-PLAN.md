---
phase: 09-matchup-ui
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - packages/frontend/components/matchup/TeamSelect.tsx
  - packages/frontend/lib/prediction-api.ts
  - packages/frontend/components/matchup/MatchupForm.tsx
  - packages/frontend/app/matchup/page.tsx
autonomous: true
---

<objective>
Create opponent selection and prediction API client with Greptile-inspired design.

Purpose: Allow users to select opponent team and configure matchup parameters (week/season), then fetch predictions from Python API.
Output: TeamSelect component, prediction API client service, MatchupForm component with cohesive Greptile styling.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan provides design system and player components
@.planning/phases/09-matchup-ui/09-01-SUMMARY.md

# Python API prediction schemas (17 features required)
@packages/backend/src/lineupiq/api/schemas/prediction.py

# Convex hooks for storing predictions
@packages/frontend/hooks/usePredictions.ts
@packages/frontend/hooks/useScoringConfigs.ts

# Shadcn UI components
@packages/frontend/components/ui/select.tsx
@packages/frontend/components/ui/input.tsx
@packages/frontend/components/ui/button.tsx
@packages/frontend/components/ui/section-label.tsx
</context>

<design_system>
**Greptile Design Guidelines (continued from 09-01):**

1. **Form Elements:**
   - Inputs: bg-white rounded-lg border-border/50 shadow-sm
   - Select dropdowns: Clean white with subtle shadow
   - Focus states: ring-2 ring-primary/20

2. **Layout:**
   - Generous spacing between form sections (gap-8)
   - Clear visual grouping with white card sections
   - Inline labels above inputs (not floating)

3. **Buttons:**
   - Primary CTA: bg-primary text-primary-foreground rounded-lg px-6 py-3
   - Large, confident button sizing
   - Subtle hover state (brightness or shadow change)

4. **Visual Hierarchy:**
   - Use SectionLabel for form section titles
   - Muted helper text below inputs
   - Clear disabled states for incomplete forms
</design_system>

<tasks>

<task type="auto">
  <name>Task 1: Create TeamSelect component</name>
  <files>packages/frontend/components/matchup/TeamSelect.tsx</files>
  <action>
Create a dropdown for selecting NFL opponent team with Greptile styling.

Props:
- `value: string | null` - selected team abbreviation
- `onSelect: (team: string) => void` - callback when team selected
- `placeholder?: string` - placeholder text (default: "Select opponent...")

Implementation:
- Use Shadcn Select component
- Hardcode NFL team list (32 teams) with abbreviation and full name
- Group teams by division using SelectGroup with division labels
- Display as "Team Name" in dropdown, show abbreviation after selection
- Team data as const array: { abbr: string, name: string, division: string }

NFL Teams by division:
AFC East: BUF (Bills), MIA (Dolphins), NE (Patriots), NYJ (Jets)
AFC North: BAL (Ravens), CIN (Bengals), CLE (Browns), PIT (Steelers)
AFC South: HOU (Texans), IND (Colts), JAX (Jaguars), TEN (Titans)
AFC West: DEN (Broncos), KC (Chiefs), LV (Raiders), LAC (Chargers)
NFC East: DAL (Cowboys), NYG (Giants), PHI (Eagles), WAS (Commanders)
NFC North: CHI (Bears), DET (Lions), GB (Packers), MIN (Vikings)
NFC South: ATL (Falcons), CAR (Panthers), NO (Saints), TB (Buccaneers)
NFC West: ARI (Cardinals), LAR (Rams), SEA (Seahawks), SF (49ers)

Styling:
- Select trigger: bg-white rounded-lg border-border/50 shadow-sm h-11
- Dropdown content: bg-white rounded-xl shadow-lg
- Group labels: text-xs font-semibold text-muted-foreground uppercase tracking-wider
- Items: hover:bg-muted/50 rounded-md

Export NFL_TEAMS constant for potential reuse.
  </action>
  <verify>File exists and exports TeamSelect component and NFL_TEAMS constant</verify>
  <done>TeamSelect renders elegant dropdown with all 32 teams grouped by division</done>
</task>

<task type="auto">
  <name>Task 2: Create prediction API client</name>
  <files>packages/frontend/lib/prediction-api.ts</files>
  <action>
Create a client service for calling the Python prediction API.

Types:
```typescript
export interface PredictionFeatures {
  passing_yards_roll3: number;
  passing_tds_roll3: number;
  rushing_yards_roll3: number;
  rushing_tds_roll3: number;
  carries_roll3: number;
  receiving_yards_roll3: number;
  receiving_tds_roll3: number;
  receptions_roll3: number;
  opp_pass_defense_strength: number;
  opp_rush_defense_strength: number;
  opp_pass_yards_allowed_rank: number;
  opp_rush_yards_allowed_rank: number;
  opp_total_yards_allowed_rank: number;
  temp_normalized: number;
  wind_normalized: number;
  is_home: boolean;
  is_dome: boolean;
}

export interface QBPrediction { passing_yards: number; passing_tds: number; }
export interface RBPrediction { rushing_yards: number; rushing_tds: number; carries: number; receiving_yards: number; receptions: number; }
export interface ReceiverPrediction { receiving_yards: number; receiving_tds: number; receptions: number; }
export type Prediction = QBPrediction | RBPrediction | ReceiverPrediction;
```

Functions:
- `predictQB(features: PredictionFeatures): Promise<QBPrediction>`
- `predictRB(features: PredictionFeatures): Promise<RBPrediction>`
- `predictWR(features: PredictionFeatures): Promise<ReceiverPrediction>`
- `predictTE(features: PredictionFeatures): Promise<ReceiverPrediction>`
- `predict(position: string, features: PredictionFeatures): Promise<Prediction>`

Implementation:
- Use fetch to POST to `${API_BASE_URL}/predict/{position.toLowerCase()}`
- API_BASE_URL from env var NEXT_PUBLIC_PREDICTION_API_URL (default: "http://localhost:8000")
- Set Content-Type: application/json header
- Throw error on non-ok response with status and message
- Export types and functions

Helper function for creating default features:
```typescript
export function createDefaultFeatures(position: string, isHome: boolean): PredictionFeatures {
  // Return position-typical rolling stats with neutral opponent values
  const base = {
    opp_pass_defense_strength: 1.0,
    opp_rush_defense_strength: 1.0,
    opp_pass_yards_allowed_rank: 16,
    opp_rush_yards_allowed_rank: 16,
    opp_total_yards_allowed_rank: 16,
    temp_normalized: 0.6,
    wind_normalized: 0.2,
    is_home: isHome,
    is_dome: false,
  };

  // Position-typical rolling stats
  if (position === "QB") return { ...base, passing_yards_roll3: 250, passing_tds_roll3: 1.8, rushing_yards_roll3: 15, rushing_tds_roll3: 0.1, carries_roll3: 3, receiving_yards_roll3: 0, receiving_tds_roll3: 0, receptions_roll3: 0 };
  if (position === "RB") return { ...base, passing_yards_roll3: 0, passing_tds_roll3: 0, rushing_yards_roll3: 65, rushing_tds_roll3: 0.5, carries_roll3: 15, receiving_yards_roll3: 20, receiving_tds_roll3: 0.1, receptions_roll3: 2.5 };
  // WR/TE default
  return { ...base, passing_yards_roll3: 0, passing_tds_roll3: 0, rushing_yards_roll3: 2, rushing_tds_roll3: 0, carries_roll3: 0.3, receiving_yards_roll3: 55, receiving_tds_roll3: 0.4, receptions_roll3: 4 };
}
```
  </action>
  <verify>File exists and exports predict function, types, and createDefaultFeatures helper</verify>
  <done>prediction-api.ts exports typed functions for calling Python prediction endpoints</done>
</task>

<task type="auto">
  <name>Task 3: Create MatchupForm component</name>
  <files>packages/frontend/components/matchup/MatchupForm.tsx</files>
  <action>
Create the complete matchup configuration form with Greptile styling.

Props:
- `onSubmit: (matchup: MatchupData) => void` - callback when form submitted
- `isLoading?: boolean` - disable form while predicting

MatchupData type (export this):
```typescript
export interface MatchupData {
  playerId: string;
  playerName: string;
  position: string;
  team: string;
  opponentTeam: string;
  week: number;
  season: number;
  isHome: boolean;
}
```

Form structure (Greptile-inspired):
```
[White Card - rounded-xl shadow-sm p-8]
  [Section 1: Player]
    - SectionLabel "[SELECT PLAYER]"
    - PositionFilter
    - PlayerSelect
    - Selected player display (when chosen)

  [Divider - border-t border-border/30 my-8]

  [Section 2: Matchup Details]
    - SectionLabel "[MATCHUP DETAILS]"
    - Grid layout (2 columns on desktop):
      - TeamSelect (opponent)
      - Week input (1-18)
      - Season input (default current year)
      - Home/Away toggle

  [Submit Button]
    - Full width on mobile, auto on desktop
    - "Get Prediction" text
    - Disabled until player and opponent selected
    - bg-primary text-primary-foreground rounded-lg py-3 px-8
    - Loading state with spinner
```

Styling details:
- Form sections separated by subtle divider
- Input labels: text-sm font-medium text-foreground mb-2
- Inputs: h-11 rounded-lg bg-white border-border/50
- Home/Away: Use checkbox with label or toggle switch
- Disabled button: opacity-50 cursor-not-allowed
  </action>
  <verify>File exists and exports MatchupForm component and MatchupData type</verify>
  <done>MatchupForm combines all selection components with elegant Greptile styling</done>
</task>

<task type="auto">
  <name>Task 4: Integrate MatchupForm into page</name>
  <files>packages/frontend/app/matchup/page.tsx</files>
  <action>
Update matchup page to use the complete MatchupForm component.

Page structure update:
```
[Warm background - full viewport]
  [Container - max-w-4xl mx-auto px-6 py-12]
    [Hero Section]
      - SectionLabel "[MATCHUP SIMULATOR]"
      - Heading: "Build Your Matchup" (text-4xl md:text-5xl font-bold tracking-tight)
      - Subheading: "Select a player and opponent to see ML-powered stat projections"
        (text-lg text-muted-foreground max-w-2xl)
      - Spacing: mb-12

    [MatchupForm - white card]
      - Pass onSubmit handler
      - Pass isLoading state

    [Results Section - placeholder for 09-03]
      - When matchup submitted, show "Prediction loading..." or placeholder
      - Reserve space for StatProjection and FantasyPointsCard (coming in 09-03)
```

State management:
- useState for matchupData (null initially)
- useState for isLoading (false)
- onSubmit handler: store matchupData, log to console (prediction display in 09-03)

After form submission, show a simple confirmation:
- "Matchup configured: {playerName} vs {opponentTeam} (Week {week})"
- Use a subtle bg-white rounded-xl p-6 card below the form
- This section will be replaced by actual predictions in 09-03
  </action>
  <verify>pnpm build succeeds, matchup page shows complete form with all fields</verify>
  <done>Matchup page displays elegant form with all configuration options</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm build` in packages/frontend succeeds without errors
- [ ] TeamSelect shows all 32 teams grouped by division with clean styling
- [ ] prediction-api.ts compiles without TypeScript errors
- [ ] MatchupForm renders with clear section separation and Greptile styling
- [ ] Submit button disabled until player and opponent selected
- [ ] Form submission shows confirmation message
- [ ] All form elements have consistent styling (rounded-lg, shadow-sm, proper spacing)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Matchup configuration form complete with cohesive Greptile design
</success_criteria>

<output>
After completion, create `.planning/phases/09-matchup-ui/09-02-SUMMARY.md`
</output>
