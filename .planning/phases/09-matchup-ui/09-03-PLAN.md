---
phase: 09-matchup-ui
plan: 03
type: execute
wave: 3
depends_on: ["09-02"]
files_modified:
  - packages/frontend/components/matchup/StatProjection.tsx
  - packages/frontend/components/matchup/FantasyPointsCard.tsx
  - packages/frontend/lib/fantasy-points.ts
  - packages/frontend/app/matchup/page.tsx
autonomous: false
---

<objective>
Create stat projection display and fantasy points calculation, complete the matchup UI.

Purpose: Show predicted stats from ML model and calculate fantasy points using configurable scoring.
Output: StatProjection component, FantasyPointsCard component, fantasy points calculator, integrated matchup page.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
@./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plans provide components and API client
@.planning/phases/09-matchup-ui/09-01-SUMMARY.md
@.planning/phases/09-matchup-ui/09-02-SUMMARY.md

# Prediction API types and client
@packages/frontend/lib/prediction-api.ts

# Scoring config hooks
@packages/frontend/hooks/useScoringConfigs.ts

# Convex schema for scoring config structure
@packages/frontend/convex/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create fantasy points calculator</name>
  <files>packages/frontend/lib/fantasy-points.ts</files>
  <action>
Create utility functions to calculate fantasy points from predicted stats.

Types (import from convex schema or redefine):
```typescript
interface ScoringConfig {
  passing: { yardsPerPoint: number; tdPoints: number; intPoints: number; };
  rushing: { yardsPerPoint: number; tdPoints: number; };
  receiving: { yardsPerPoint: number; tdPoints: number; receptionPoints: number; };
}

interface QBPrediction { passing_yards: number; passing_tds: number; }
interface RBPrediction { rushing_yards: number; rushing_tds: number; carries: number; receiving_yards: number; receptions: number; }
interface ReceiverPrediction { receiving_yards: number; receiving_tds: number; receptions: number; }
```

Functions:
- `calculateQBPoints(prediction: QBPrediction, config: ScoringConfig): number`
  - passing_yards / yardsPerPoint + passing_tds * tdPoints
  - Round to 1 decimal

- `calculateRBPoints(prediction: RBPrediction, config: ScoringConfig): number`
  - rushing_yards / rushing.yardsPerPoint + rushing_tds * rushing.tdPoints
  - receiving_yards / receiving.yardsPerPoint + receiving_tds * receiving.tdPoints
  - receptions * receiving.receptionPoints
  - Round to 1 decimal

- `calculateReceiverPoints(prediction: ReceiverPrediction, config: ScoringConfig): number`
  - receiving_yards / yardsPerPoint + receiving_tds * tdPoints + receptions * receptionPoints
  - Round to 1 decimal

- `calculateFantasyPoints(position: string, prediction: object, config: ScoringConfig): number`
  - Router function that calls appropriate calculator based on position

Export all types and functions.
  </action>
  <verify>File exists and exports calculateFantasyPoints function</verify>
  <done>Fantasy points calculator handles all positions with configurable scoring</done>
</task>

<task type="auto">
  <name>Task 2: Create StatProjection component</name>
  <files>packages/frontend/components/matchup/StatProjection.tsx</files>
  <action>
Create component to display predicted stats in a clear format.

Props:
- `position: "QB" | "RB" | "WR" | "TE"`
- `prediction: QBPrediction | RBPrediction | ReceiverPrediction`
- `isLoading?: boolean`

Implementation:
- Use Card with CardHeader showing position name
- Display stats in a grid layout (2 columns on mobile, 3 on desktop)
- Each stat shows label and value with appropriate formatting
- Use Skeleton components when isLoading is true

Stat display by position:
- QB: Passing Yards, Passing TDs
- RB: Rushing Yards, Rushing TDs, Carries, Receiving Yards, Receptions
- WR/TE: Receiving Yards, Receiving TDs, Receptions

Format numbers to 1 decimal place. Use large bold text for values.
  </action>
  <verify>File exists and exports StatProjection component</verify>
  <done>StatProjection displays position-appropriate stats in clean grid layout</done>
</task>

<task type="auto">
  <name>Task 3: Create FantasyPointsCard component</name>
  <files>packages/frontend/components/matchup/FantasyPointsCard.tsx</files>
  <action>
Create component to display calculated fantasy points with scoring breakdown.

Props:
- `points: number` - total fantasy points
- `position: string`
- `prediction: object` - the raw prediction
- `scoringConfig: ScoringConfig`
- `isLoading?: boolean`

Implementation:
- Use Card with prominent total points display (large text, primary color)
- Show scoring config name being used
- Collapsible breakdown section showing point contribution per stat:
  - QB: "Passing Yards: X pts, Passing TDs: X pts"
  - RB: "Rushing: X pts, Receiving: X pts"
  - WR/TE: "Receiving Yards: X pts, TDs: X pts, Receptions: X pts"
- Use Skeleton when loading

Make the total points visually prominent - this is the key output users care about.
  </action>
  <verify>File exists and exports FantasyPointsCard component</verify>
  <done>FantasyPointsCard shows total points prominently with optional breakdown</done>
</task>

<task type="auto">
  <name>Task 4: Integrate prediction display into matchup page</name>
  <files>packages/frontend/app/matchup/page.tsx</files>
  <action>
Update matchup page to fetch predictions and display results.

Implementation:
- Add state for: prediction (null), isLoading (false), error (null)
- Import predict function from prediction-api.ts
- Import useDefaultScoringConfig hook
- Import calculateFantasyPoints from fantasy-points.ts
- Import StatProjection and FantasyPointsCard components

onSubmit handler:
1. Set isLoading true, clear error
2. Create mock features object with reasonable defaults:
   - Rolling stats: use position-typical values (QB: 250 pass yards, etc.)
   - Opponent features: use neutral values (0.5 for strength, 16 for ranks)
   - Weather: temp_normalized=0.6, wind_normalized=0.2
   - is_home from form, is_dome=false
3. Call predict(position, features)
4. Store prediction in state
5. On error, set error state and show toast/alert
6. Set isLoading false

Display section (below form):
- When prediction exists:
  - Show player name and matchup info header
  - StatProjection component with prediction
  - FantasyPointsCard with calculated points
- When loading: show skeleton placeholders
- When error: show error message with retry button

Layout: Stack form above results, max-w-4xl container for wider results display.
  </action>
  <verify>pnpm build succeeds, page shows prediction results after form submission</verify>
  <done>Matchup page fetches predictions and displays stats with fantasy points</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete matchup simulator UI with player selection, opponent selection, and stat predictions</what-built>
  <how-to-verify>
    1. Start Python API: cd packages/backend && uv run uvicorn lineupiq.api.main:app --port 8000
    2. Start frontend: cd packages/frontend && pnpm dev
    3. Visit: http://localhost:3000/matchup
    4. Test flow:
       a. Select position filter (e.g., QB) - buttons should highlight
       b. Select a player from dropdown (may need to seed player data first)
       c. Select opponent team from dropdown - verify all 32 teams grouped by division
       d. Enter week number (1-18) and season
       e. Toggle home/away
       f. Click "Get Prediction"
    5. Verify prediction display:
       a. Stats shown match position type (passing for QB, rushing for RB, etc.)
       b. Fantasy points calculated and displayed prominently
       c. No console errors
       d. Responsive layout works (try narrower window)

    Note: If player data is empty, predictions still work but player select will be empty. This is expected - player seeding comes in Phase 10.
  </how-to-verify>
  <resume-signal>Type "approved" if UI works correctly, or describe any issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm build` in packages/frontend succeeds without errors
- [ ] Fantasy points calculator returns correct values for standard scoring
- [ ] StatProjection displays appropriate stats per position
- [ ] FantasyPointsCard shows total points prominently
- [ ] Full matchup flow works end-to-end (with Python API running)
- [ ] Human verification checkpoint approved
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Human approved visual verification
- Complete matchup simulator functional
</success_criteria>

<output>
After completion, create `.planning/phases/09-matchup-ui/09-03-SUMMARY.md`
</output>
