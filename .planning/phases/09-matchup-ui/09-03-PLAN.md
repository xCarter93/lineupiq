---
phase: 09-matchup-ui
plan: 03
type: execute
wave: 3
depends_on: ["09-02"]
files_modified:
  - packages/frontend/components/matchup/StatProjection.tsx
  - packages/frontend/components/matchup/FantasyPointsCard.tsx
  - packages/frontend/lib/fantasy-points.ts
  - packages/frontend/app/matchup/page.tsx
autonomous: false
---

<objective>
Create stat projection display and fantasy points calculation with Greptile-inspired design, complete the matchup UI.

Purpose: Show predicted stats from ML model and calculate fantasy points using configurable scoring, with polished visual presentation.
Output: StatProjection component, FantasyPointsCard component, fantasy points calculator, integrated matchup page.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
@./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plans provide design system, components, and API client
@.planning/phases/09-matchup-ui/09-01-SUMMARY.md
@.planning/phases/09-matchup-ui/09-02-SUMMARY.md

# Prediction API types and client
@packages/frontend/lib/prediction-api.ts

# Scoring config hooks
@packages/frontend/hooks/useScoringConfigs.ts

# Convex schema for scoring config structure
@packages/frontend/convex/schema.ts
</context>

<design_system>
**Greptile Design Guidelines (results display):**

1. **Data Presentation:**
   - Large, bold numbers for key stats (text-4xl to text-6xl font-bold)
   - Clear labels in muted text above or below values
   - Grid layout for multiple stats (2-3 columns)
   - Visual hierarchy: fantasy points most prominent

2. **Results Cards:**
   - White cards with subtle shadow on warm background
   - Generous padding (p-8 to p-10)
   - rounded-xl for consistency
   - Clear section separation

3. **Visual Accents:**
   - Primary color (emerald) for key numbers like fantasy points
   - Subtle background tints for stat categories
   - Clean dividers between sections

4. **Animation/Polish:**
   - Smooth transitions for loading states
   - Subtle fade-in for results
   - Skeleton loaders matching final layout

5. **Information Hierarchy:**
   - Fantasy points card: Hero position, largest text
   - Stat breakdown: Supporting detail, clean grid
   - Scoring breakdown: Tertiary, collapsible/subtle
</design_system>

<tasks>

<task type="auto">
  <name>Task 1: Create fantasy points calculator</name>
  <files>packages/frontend/lib/fantasy-points.ts</files>
  <action>
Create utility functions to calculate fantasy points from predicted stats.

Types:
```typescript
export interface ScoringConfig {
  passing: { yardsPerPoint: number; tdPoints: number; intPoints: number; };
  rushing: { yardsPerPoint: number; tdPoints: number; };
  receiving: { yardsPerPoint: number; tdPoints: number; receptionPoints: number; };
}

// Import prediction types from prediction-api.ts or redefine
export interface QBPrediction { passing_yards: number; passing_tds: number; }
export interface RBPrediction { rushing_yards: number; rushing_tds: number; carries: number; receiving_yards: number; receptions: number; }
export interface ReceiverPrediction { receiving_yards: number; receiving_tds: number; receptions: number; }
```

Functions:
- `calculateQBPoints(prediction: QBPrediction, config: ScoringConfig): number`
  Formula: (passing_yards / yardsPerPoint) + (passing_tds * tdPoints)
  Round to 1 decimal place

- `calculateRBPoints(prediction: RBPrediction, config: ScoringConfig): number`
  Formula: (rushing_yards / rushing.yardsPerPoint) + (rushing_tds * rushing.tdPoints)
           + (receiving_yards / receiving.yardsPerPoint) + (receiving_tds * receiving.tdPoints)
           + (receptions * receiving.receptionPoints)
  Round to 1 decimal place

- `calculateReceiverPoints(prediction: ReceiverPrediction, config: ScoringConfig): number`
  Formula: (receiving_yards / yardsPerPoint) + (receiving_tds * tdPoints) + (receptions * receptionPoints)
  Round to 1 decimal place

- `calculateFantasyPoints(position: string, prediction: object, config: ScoringConfig): number`
  Router function: switch on position (QB/RB/WR/TE), call appropriate calculator

- `getPointsBreakdown(position: string, prediction: object, config: ScoringConfig): PointsBreakdown`
  Returns object showing contribution from each stat category:
  ```typescript
  interface PointsBreakdown {
    total: number;
    categories: { label: string; points: number; detail: string; }[];
  }
  ```
  Example for QB: { total: 18.7, categories: [
    { label: "Passing Yards", points: 10.7, detail: "267.3 yards" },
    { label: "Passing TDs", points: 8.0, detail: "2 TDs Ã— 4 pts" }
  ]}

Export all types and functions.
  </action>
  <verify>File exists and exports calculateFantasyPoints and getPointsBreakdown functions</verify>
  <done>Fantasy points calculator handles all positions with detailed breakdown support</done>
</task>

<task type="auto">
  <name>Task 2: Create StatProjection component</name>
  <files>packages/frontend/components/matchup/StatProjection.tsx</files>
  <action>
Create component to display predicted stats with Greptile-inspired styling.

Props:
- `position: "QB" | "RB" | "WR" | "TE"`
- `prediction: QBPrediction | RBPrediction | ReceiverPrediction`
- `playerName: string`
- `opponentTeam: string`
- `isLoading?: boolean`

Structure:
```
[White Card - rounded-xl shadow-sm]
  [Header]
    - SectionLabel "[PROJECTED STATS]"
    - Player vs Opponent subtitle

  [Stats Grid]
    - 2 columns on mobile, 3 on desktop
    - Each stat: large value (text-3xl font-bold) with label below (text-sm text-muted-foreground)

  [Loading State]
    - Skeleton blocks matching final layout
    - animate-pulse effect
```

Stats by position:
- QB: Passing Yards, Passing TDs (2 stats, large prominent display)
- RB: Rushing Yards, Rushing TDs, Carries, Receiving Yards, Receptions (5 stats, grid layout)
- WR/TE: Receiving Yards, Receiving TDs, Receptions (3 stats)

Styling:
- Stat values: text-3xl font-bold text-foreground
- Stat labels: text-sm text-muted-foreground uppercase tracking-wide
- Grid: grid grid-cols-2 md:grid-cols-3 gap-6
- Card: bg-white rounded-xl shadow-sm p-8

Export as named export.
  </action>
  <verify>File exists and exports StatProjection component</verify>
  <done>StatProjection displays position-appropriate stats with clean Greptile grid layout</done>
</task>

<task type="auto">
  <name>Task 3: Create FantasyPointsCard component</name>
  <files>packages/frontend/components/matchup/FantasyPointsCard.tsx</files>
  <action>
Create hero component for displaying fantasy points with prominent styling.

Props:
- `points: number` - total fantasy points
- `breakdown: PointsBreakdown` - from getPointsBreakdown()
- `scoringConfigName: string` - e.g., "Standard", "PPR"
- `isLoading?: boolean`

Structure:
```
[White Card - rounded-xl shadow-sm - HERO STYLING]
  [Main Display]
    - SectionLabel "[FANTASY POINTS]"
    - Giant points number: text-6xl md:text-7xl font-bold text-primary
    - "projected points" label below: text-lg text-muted-foreground
    - Scoring config badge: "Standard Scoring" in subtle chip/badge

  [Points Breakdown - collapsible or always visible]
    - Divider line
    - Each category as row:
      - Label (left): "Passing Yards"
      - Detail (center): "267.3 yds"
      - Points (right): "+10.7 pts"
    - Clean horizontal layout with justify-between

  [Loading State]
    - Large skeleton for points
    - Smaller skeletons for breakdown rows
```

Styling:
- Card: bg-white rounded-xl shadow-sm p-8 md:p-10
- Points number: text-6xl md:text-7xl font-bold text-primary (emerald)
- Subtitle: text-lg text-muted-foreground
- Breakdown rows: py-3 border-b border-border/30 last:border-0
- Use tabular-nums for point values (consistent width)

This should be the visual hero of the results - the number users care about most.

Export as named export.
  </action>
  <verify>File exists and exports FantasyPointsCard component</verify>
  <done>FantasyPointsCard shows fantasy points prominently with Greptile hero styling</done>
</task>

<task type="auto">
  <name>Task 4: Integrate prediction display into matchup page</name>
  <files>packages/frontend/app/matchup/page.tsx</files>
  <action>
Update matchup page to fetch predictions and display results with full Greptile styling.

State additions:
- prediction: Prediction | null
- isLoading: boolean
- error: string | null

Import:
- predict, createDefaultFeatures from prediction-api.ts
- useDefaultScoringConfig from hooks
- calculateFantasyPoints, getPointsBreakdown from fantasy-points.ts
- StatProjection, FantasyPointsCard components

onSubmit handler update:
```typescript
async function handleSubmit(matchup: MatchupData) {
  setIsLoading(true);
  setError(null);
  setMatchupData(matchup);

  try {
    const features = createDefaultFeatures(matchup.position, matchup.isHome);
    const result = await predict(matchup.position, features);
    setPrediction(result);
  } catch (err) {
    setError(err instanceof Error ? err.message : "Failed to get prediction");
  } finally {
    setIsLoading(false);
  }
}
```

Results section structure:
```
[Below MatchupForm, when prediction exists or loading]

  [Results Container - mt-8]
    [Two-column layout on desktop, stack on mobile]

      [Left/Top: FantasyPointsCard]
        - Hero display of total points
        - Full breakdown

      [Right/Bottom: StatProjection]
        - Position-specific stats grid

  [Error State]
    - When error: show error card with message and "Try Again" button
    - Red/destructive styling subtle
```

Layout:
- Results grid: grid md:grid-cols-2 gap-6
- Fantasy points card: spans full width or left column
- Or single column stack: FantasyPointsCard first (hero), then StatProjection

Add smooth transition/animation:
- Results section: animate-in fade-in duration-300
- Or simple opacity transition when results appear

Handle API not running:
- Show helpful error: "Prediction API not available. Start the API with: cd packages/backend && uv run uvicorn lineupiq.api.main:app --port 8000"
  </action>
  <verify>pnpm build succeeds, page shows prediction results with hero fantasy points display</verify>
  <done>Matchup page displays beautiful results with prominent fantasy points and stat grid</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete matchup simulator UI with Greptile-inspired design: warm cream background, white cards, player/opponent selection, and ML-powered stat predictions with fantasy points display</what-built>
  <how-to-verify>
    1. Start Python API: cd packages/backend && uv run uvicorn lineupiq.api.main:app --port 8000
    2. Start frontend: cd packages/frontend && pnpm dev
    3. Visit: http://localhost:3000/matchup

    4. Check design system:
       a. Background should be warm cream/beige (not pure white)
       b. Cards should be white with subtle shadow
       c. Section labels should appear in [BRACKETS] format
       d. Typography should be large and bold for headings
       e. Generous whitespace throughout

    5. Test matchup flow:
       a. Position filter buttons should be pill-shaped with clear active state
       b. Player dropdown should have elegant styling (may be empty without seeded data)
       c. Team dropdown should show 32 teams grouped by division
       d. Week/season inputs and home/away toggle should work
       e. Submit button disabled until player and opponent selected

    6. Test prediction display:
       a. Click "Get Prediction" (with or without player - API accepts features directly)
       b. Fantasy points should display prominently in emerald/green (text-6xl or similar)
       c. Stats should show in clean grid layout
       d. Breakdown should show point contribution per stat

    7. Visual polish check:
       a. Smooth loading states (skeletons or spinners)
       b. Error handling if API not running
       c. Responsive layout on mobile (stack instead of grid)
       d. Overall aesthetic matches Greptile's clean, minimal style

    Note: Player data may be empty until seeded in Phase 10. The prediction flow will still work with default features.
  </how-to-verify>
  <resume-signal>Type "approved" if the Greptile-inspired UI looks polished and works correctly, or describe any design or functionality issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `pnpm build` in packages/frontend succeeds without errors
- [ ] Fantasy points calculator returns correct values for standard scoring
- [ ] StatProjection displays appropriate stats per position with Greptile styling
- [ ] FantasyPointsCard shows total points prominently as visual hero
- [ ] Full matchup flow works end-to-end (with Python API running)
- [ ] Design matches Greptile aesthetic (warm background, white cards, large typography, generous spacing)
- [ ] Human verification checkpoint approved
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Human approved Greptile-inspired visual design
- Complete matchup simulator functional and polished
</success_criteria>

<output>
After completion, create `.planning/phases/09-matchup-ui/09-03-SUMMARY.md`
</output>
